% =================================================================================================
% set document class
% =================================================================================================
\documentclass[slidecentered,compress,dvipsnames,table,xcdraw,aspectratio=169]{beamer}

% =================================================================================================
% packages
% =================================================================================================
\usepackage{animate}
\usepackage{multicol}
\usepackage{algorithm}
\usepackage{algpseudocode}
\usepackage{amsmath}
\usepackage{amssymb}
\usepackage{amsthm}
\usepackage{mathtools}
\usepackage[utf8]{inputenc}
\usepackage[english]{babel}
% \usepackage[T1]{fontenc}		% not removing this so that you rememeber; adding this makes fonts jaggedy
\usepackage{tcolorbox}
% \RequirePackage{fix-cm}		% also, this one makes the fonts thinner (not strokes; the actual size)
\usepackage{transparent}
\usepackage{textpos}
\usepackage{tikz}
\usepackage{xstring}	% need for soul \hl
\usefonttheme{professionalfonts}
\usefonttheme[onlymath]{serif}
\usepackage{contour}
\usepackage{ulem}
\usepackage{soul}
\usepackage{svg}
\usepackage{calligra}
%\usepackage[style=ieee]{biblatex}
\usepackage[pro]{fontawesome5}
\usepackage{graphicx}
\usepackage{lipsum}
\usepackage{xcolor}
\usepackage[style=verbose]{biblatex}
\usepackage{pgfplots}
\usepackage{amsfonts}
\usepackage{array}
\usepackage{bm}
\usepackage{breakcites}
\usepackage{color}
\usepackage{comment}
\usepackage{float}
\usepackage{gensymb}
\usepackage{multirow}
\usepackage{pdfpages}
\usepackage[caption=false,font=footnotesize,subrefformat=parens,labelformat=parens]{subfig}
\usepackage{textcomp}
\usepackage{wrapfig}
\usepackage{tabularx}

% =================================================================================================
% settings for customization
% =================================================================================================

% set the inkscape .exe path here. needed to include svg directly
\setsvg{inkscape = "C:/Program Files/Inkscape/inkscape.exe" -z -D}

% tikz libraries
\usetikzlibrary{shadows}

% Numbered captions of tables, pictures, etc.
\setbeamertemplate{caption}[numbered]

% Bibliography settings
\addbibresource{references.bib}
\setbeamertemplate{bibliography item}{\insertbiblabel}

% set graphics path
\graphicspath{{figures/}}

% get rid of tiny navigation buttons; never use it anyway
\beamertemplatenavigationsymbolsempty

% set the footnote size to tiny
\setbeamerfont{footnote}{size=\tiny}
% add extra space to accomodate progress bar
\setbeamertemplate{footline}{\vspace{7pt}}
% adjust footnote separation to save space
\setlength{\footnotesep}{0.18cm}

% set footnote color
\setbeamercolor{footnote}{fg=STEEL_BLUE_2}

% edit footnote footcite pattern
\makeatletter
\newbibmacro*{hypercite}{%
    \renewcommand{\@makefntext}[1]{\noindent\tiny##1}%
    \footnotetext{%
        \blxmkbibnote{foot}{%
            \printtext[labelnumberwidth]{%
                \printfield{prefixnumber}%
                \printfield{labelnumber}%
            }%
            \addspace%
            \printnames[][1-1]{author}
            \setunit{\addcomma\addspace}
            \printfield{year}
            \setunit{\addcomma\addspace}
            \printfield{title}
        }%
    }%
}%
\DeclareCiteCommand{\hypercite}%
{\usebibmacro{cite:init}}
{\usebibmacro{hypercite}}
{}
{\usebibmacro{cite:dump}}
%
%% Redefine the \footcite command to use the reference number
%\renewcommand{\footcite}[1]{\cite{#1}\hypercite{#1}}
%\makeatother


% set bibliography font size
\renewcommand*{\bibfont}{\scriptsize}

% declare label name to compile named frames only
% \includeonlyframes{current}

% =================================================================================================
% input (import) modules
% =================================================================================================
\input{./math_defs}
\input{./color_defs}

% always comment below line until last compile. It takes a while to add progress bar features on slides.
%\input{./progress_bar}

% set global color for normal text (almost black)
\setbeamercolor{normal text}{fg=BLACK_CHOCOLATE}

% =================================================================================================
% set mode and theme
% =================================================================================================
\mode<presentation>{\usetheme{Antibes}\usecolortheme[named=YALE_BLUE]{structure}}


% =================================================================================================
% new command definitions
% =================================================================================================
% \newcommand{\fnt}[1]{\fontsize{#1}{0}\selectfont}

% tikzmark can be used to draw things like arbitrary arrows between two marked points
% usage: \tikzmark{mark1}
\newcommand\tikzmark[1]{\tikz[overlay, remember picture] \node (#1) {};}

% helper command to display circle with given color and name
% usage: \colorshow{BRIGHT_MAROON}
\newcommand{\colorshow}[1]{
    \begin{tikzpicture}
        \node[fill=#1,
            circle,
            minimum size=2ex,
            label={\tiny \StrSubstitute{#1}{_}{\ }},
        ] at (0,0){};
    \end{tikzpicture}
}

% helper command to set inactive text
\newcommand{\unemph}[1]{\texttransparent{0.2}{#1}}

% renew underline \myul
% \myul will underline closer not cutting through p's and y's hanging tails
% for the usual underline use \ul
\renewcommand{\ULdepth}{1.8pt}
\contourlength{0.8pt}

\newcommand{\myul}[1]{%
    \uline{\phantom{#1}}%
    \llap{\contour{white}{#1}}%
}
\makeatletter
\let\HL\hl
\renewcommand{\hl}{%
    \let\set@color\beamerorig@set@color
    \let\reset@color\beamerorig@reset@color
    \HL}
\makeatother

% set the highlight color
% usage: \hl{dummy text}
\sethlcolor{MINDARO}


% =================================================================================================
% define title
% =================================================================================================
\title[{Variable Rate Compression for Raw 3D Point Clouds}]{
        {Variable Rate Compression for Raw 3D Point Clouds}
}

%\subtitle{\small A second date}
\author{\textcolor{RAISIN_BLACK}{Md Ahmed Al Muzaddid and William J. Beksi}\\ICRA, 2022}
\institute{
    \includegraphics[height=1cm]{figures/uta_logo}\newline \newline
    \textcolor{BRIGHT_MAROON}{\bf \small University of Texas, Arlington} \newline
    \textcolor{NICKEL}{\tiny 05/24/2022}\newline \newline
}
% RVL logo
\titlegraphic{\vspace{-15mm}\includegraphics[height=1cm]{icra_logo_full} \hfill \includegraphics[height=1cm]{rvl_logo_2.pdf}}
\date{}


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

% =================================================================================================
% DOCUMENT BEGINS HERE
% =================================================================================================
\begin{document}

% -------------------------------------------------------------------------------------------------
% title
% -------------------------------------------------------------------------------------------------
%% title frame
    \begin{frame}
        \titlepage
    \end{frame}

% UTA logo on all frames after
    \addtobeamertemplate{frametitle}{}{
        \begin{textblock*}{100mm}(0.95\textwidth,-0.96cm)
            \includegraphics[height=0.95cm,]{icra_logo_inverse}
        \end{textblock*}
    }

% -------------------------------------------------------------------------------------------------
% table of contents
% -------------------------------------------------------------------------------------------------
% %% ToC
% \begin{frame}{Outline}
% 	\tableofcontents
% \end{frame}

% %% ToC at beginning of sections
% \AtBeginSection[]
% {
% \begin{frame}{Outline}
% 	\tableofcontents[currentsection]
% \end{frame}
% }

% %% ToC at beginning of subsections
% \AtBeginSubsection[]
% {
% \begin{frame}{Outline}
% 	\tableofcontents[currentsubsection]
% \end{frame}
% }


%    \begin{frame}{Outline}
%        \begin{multicols}{2}
%            \tableofcontents[sections={1-8}]
%        \end{multicols}
%    \end{frame}


%% ToC at begin of sections
    \AtBeginSection[]
    {
        \begin{frame}{Outline}
            \begin{multicols}{2}
                \tableofcontents[sections={1-8}, currentsection]
            \end{multicols}
        \end{frame}
    }
%% ToC at being subsections
    \AtBeginSubsection[]
    {
        \begin{frame}{Outline}
            \begin{multicols}{2}
                \tableofcontents[sections={1-8}, currentsubsection]
            \end{multicols}
        \end{frame}
    }

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% =================================================================================================
% MAIN CONTENT STARTS HERE
% =================================================================================================

% -------------------------------------------------------------------------------------------------
% introduction
% -------------------------------------------------------------------------------------------------


    \begin{frame}{Learning based 3D compression}
        \begin{columns}
            \column{0.5\textwidth}
            \only<1>{
                \begin{itemize}
                \item Inspired by learning  based Image compression
                \item Unlike 2D image, the structure of a 3D point cloud is irregular
                \item To overcome irregularity, point clouds are typically voxelized\footcite{ozbay2019voxelize}
                \end{itemize}
            }
            \column{0.5\textwidth}
            \centering
            \includegraphics[width=\textwidth]{voxel}
        \end{columns}
    \end{frame}


    \begin{frame}{Limitations of Voxelization based compression}
        \begin{columns}
            \column{0.5\textwidth}
            \only<1>{
                \begin{itemize}
                \item Quantization error
                \item Larger representation volume
                \item Hard to train a single model for variable bitrates
                \end{itemize}
            }
            \vspace{20pt}
            \textbf{Solution:} Voxelization free compression
            \column{0.5\textwidth}
            \centering
            \includegraphics[width=\textwidth]{overview}
            \tiny Fig: Voxelization free compression pipeline
        \end{columns}
    \end{frame}


     \begin{frame}{Architecture Overview}
        \only<1>{
            \begin{itemize}
                \item Permutation invariant encoder
                \item Multiple Decoder branch
                \item Trained to minimize loss defined on unordered Sets
                %\item but only 2 million \textbf{axons} (optic nerve endings)
            \end{itemize}
            \vspace{20pt}
            \includegraphics[width=\textwidth]{model_architecture}
        }
    \end{frame}


     \begin{frame}{Multi decoder}
        \begin{columns}
            \column{0.4\textwidth}
            \only<1>{
                \begin{itemize}
                \item Many objects, especially man-made objects, contain large smooth surfaces
                \item Deconvolution can generate locally smooth surface
                \item A fully-connected network combined with a deconvolutional network performs best
                \end{itemize}
            }
            \column{0.6\textwidth}
            \centering
            \includegraphics[width=\textwidth]{multidecoder}
            \tiny Fig: Performance on ModelNet40 (Left), Performance on ShapeNet (Right)
        \end{columns}
    \end{frame}


    \begin{frame}{Variable compression rate}
        \begin{columns}
            \column{0.5\textwidth}
            \only<1>{
                \begin{itemize}
                    \item Traditional Formulation
                        \[ L = D + \lambda R\]
                        \[ R = E_x[-\log P_{\hat{y}}(Q(g_a(x;\theta_a)))] \]

                    \item Weighted Formulation
                        \[ R_{weighted} = E_x[\sum_{i} -\omega_i \log P(\hat{y}_i)]\]
                       \[ \omega_i = a e^{-b\times i}\]
                \end{itemize}

            }
            \column{0.5\textwidth}
            %\centering
%            \includegraphics[width=\textwidth]{var_bitrate}
            \begin{figure}
                \centering
                \begin{tikzpicture}
                \begin{axis}[ xlabel=Latent Vector Size, ylabel=Chamfer Distance, width=\textwidth]%, x dir=reverse
                  \addplot[mark=*,cyan] plot coordinates {(1024,0.3184) (1020,0.3186)
                  (1024-16,0.3438) (1024-32,0.3437) (1024-64,0.3515) (1024-128,0.3554)
                  (1024-256,0.3815) (1024-300,0.3878) (1024-325,0.397) (1024-340,0.402)
                  %(1024-343,1.14) (1024-512,2.283)
                };
                %\addlegendentry{EMD}
                \end{axis}
                \end{tikzpicture}

                \end{figure}
        \end{columns}
    \end{frame}


    \begin{frame}{Experiment}
            \only<1>{
                \begin{itemize}
                    \item Dataset: ShapeNet, ModelNet40
                \end{itemize}
                \vspace{20pt}
                %\includegraphics[width=\textwidth]{timing}
                \newcolumntype{C}{>{\centering\arraybackslash}p{0.2\linewidth}}
                \begin{table}
                \begin{center}
                \begin{tabular}{|C|C|C|C|} % <-- Alignments: 1st column left, 2nd middle and 3rd right, with vertical lines in between
                  \hline
                  \multirow{2}{*}{\textbf{Task}} & \multicolumn{3}{|c|}{\textbf{Time} (msec)}\\
                  \cline{2-4}&
                   Batch size of 32 & Batch size of 16 & Batch size of \newline 1\\
                    \hline
                    Compression   & $8.50 \pm0.10$ & $8.60 \pm0.10$ & $15.20 \pm0.40$\\
                    Decompression & $0.40 \pm0.01$ & $0.50 \pm0.02$ & $2.30 \pm0.10$\\
                  \hline
                \end{tabular}
                \end{center}
                \end{table}
            }
    \end{frame}


     \begin{frame}{Qualitative results}
            \only<1>{
                \vspace{0pt}
                \includegraphics[width=.98\textwidth]{qualitative}
            }
    \end{frame}


    \begin{frame}{Quantitative results}
        \begin{columns}
            \column{0.5\textwidth}
            \only<1>{
                \begin{itemize}
                    \item Our method produces significantly better results at low bitrates compared to the
                    Draco
                \end{itemize}
            }
            \column{0.5\textwidth}
%            \centering
%            \includegraphics[width=\textwidth]{draco}
            \begin{figure}
                \centering
                \begin{tikzpicture}
                  \begin{axis}[xlabel=Bitrate,ylabel=Distance,ymode=log,width=\textwidth,]
                    \addplot[dashed,mark=*,color=cyan] plot coordinates { (0.7368, 0.3509) (0.8468, 0.1177)(1.11034, 0.0561) (1.6965, 0.0299)};%(3.0663, 0.01909)
                    \addlegendentry{\tiny$Draco_{p2p}$}
                    \addplot[smooth,mark=*,color=cyan] plot coordinates { (0.0309,0.025) (0.0808, 0.023) (0.3474,0.0241 ) (0.8687,0.0225 )(1.690192, 0.0226) };
                    % 0.0212, 0.0186, 0.0199,0.0175, 0.01804
                    \addlegendentry{\tiny$Ours_{p2p}$}
                    \addplot[dashed,mark=o,color=purple] plot coordinates { (0.737, 0.1744) (0.8483, 0.0682) (1.115, 0.0332) (1.7107, 0.0170)}; %(3.1040, 0.0105)
                    \addlegendentry{\tiny$Draco_\perp$}
                    \addplot[smooth,mark=o,color=purple] plot coordinates { (0.0309, 0.0136) (0.0808,  0.0122) (0.3474, 0.01265 ) (0.8687, 0.01188)(1.690, 0.0144 ) };
                    %0.0112, 0.0096, 0.0103,  0.0092, 0.0095
                    \addlegendentry{\tiny$Ours_\perp$}
                  \end{axis}
                \end{tikzpicture}
                \label{fig:draco_comparison}
                \end{figure}
        \end{columns}
    \end{frame}


    \begin{frame}{Quantitative results}
        \begin{columns}
            \column{0.5\textwidth}
            \only<1>{
                \begin{itemize}
                    \item Decompressed point cloud retains the semantic structure
                \end{itemize}
            }
            \column{0.5\textwidth}
%            \centering
%            \includegraphics[width=\textwidth]{cls_accuracy}
            \begin{figure}
                \centering
                \begin{tikzpicture}
                  \begin{axis}[xlabel=Bitrate,ylabel=Classification Accuracy, width=\textwidth]
                  \addplot[dashed,mark=*,color=black] plot coordinates { (0.0, 0.88442) (1.676785, 0.88442) };
                  \addlegendentry{\tiny$Uncompressed$}
                  \addplot[smooth,mark=x,color=purple] plot coordinates { (0.036987, 0.835526) (0.276215, 0.861842) (1.133270, 0.828947) (1.443545, 0.822368) };
                  \addlegendentry{\tiny$CD$}
                  \addplot[smooth,mark=*,color=cyan] plot coordinates { (0.069773, 0.808442) (0.552924, 0.829545) (1.126253, 0.845373) (1.676785, 0.834821) };
                  \addlegendentry{\tiny$EMD$}
                  \end{axis}
                \end{tikzpicture}
                \end{figure}
        \end{columns}
    \end{frame}


% % -------------------------------------------------------------------------------------------------
% % extro
% % -------------------------------------------------------------------------------------------------
\begin{frame}{}
\centering
{\Huge \calligra Thank you}
%Thank you
\end{frame}

\end{document}

